brain:
  id: "phone-to-present-cc-001"
  name: "phone_to_present_cc"
  version: "1.0.0"
  created_at: "2026-01-15T00:00:00+00:00"
  updated_at: "2026-01-15T00:00:00+00:00"
  purpose: "Analyze phone call logs and generate client-ready sales presentations with FTE-based pricing for MyBCAT services. Claude Code optimized variant with enhanced prompts and streamlined execution."

objectives:
  primary_goal: "Transform raw phone call data into a professional sales presentation that diagnoses call handling performance, quantifies impact, and recommends service options."
  objectives:
    - description: "Compute open-hours performance KPIs"
      success_criteria:
        - "Primary KPIs (answer rate, miss rate, grade, missed/week) are computed from OPEN HOURS inbound calls only."
        - "Inbound open/closed splits reconcile: TOTAL_INBOUND_ALL == TOTAL_INBOUND (open) + TOTAL_CLOSED (closed)."
        - "Disposition/direction mappings are reviewed; any high-unknown or redirected/transferred semantics are confirmed or explicitly caveated."
      priority: 1
    - description: "Model concurrency and staffing requirements"
      success_criteria:
        - "BASE_FTE is computed from time-weighted concurrency CDF at 90% coverage (exclude level 0; floor at 1.0)."
        - "Monte Carlo simulation uses a deterministic seed derived from stable dataset fingerprint; MC_FTE_90 reconciles with BASE_FTE within tolerance."
        - "SHRINKAGE_FTE follows max(BASE_FTE / 0.80, 1.25) with consistent rounding policy."
      priority: 1
    - description: "Calculate pricing, savings, ROI, and breakeven"
      success_criteria:
        - "Pricing formulas and constants match `phone_to_present/workflow/phase5_pricing.md`."
        - "Optional checks pass via `phone_to_present/scripts/verify_financials.py` when a manifest is present."
        - "Client-facing deck shows only final weekly/monthly/annual numbers (no rates, hours, or rate x FTE breakdowns)."
      priority: 1
    - description: "Generate and QA deck deliverables"
      success_criteria:
        - "All template placeholders are replaced (0 unreplaced `{{VARIABLE}}` tokens)."
        - "Template-referenced charts exist (or placeholders are generated) and render correctly in HTML + PPTX."
        - "Slide 18 (Paths Forward) uses the required v4 HTML `<table class=\"pf-table\">` construction."
      priority: 1
  deliverables:
    - name: "gold_calls.csv"
      format: "CSV (standardized call records)"
      required: true
    - name: "analysis_manifest.json"
      format: "JSON (metrics, FTE, pricing, confirmations, caveats)"
      required: true
    - name: "presentation.md"
      format: "Marp markdown (source of truth)"
      required: true
    - name: "presentation.html"
      format: "Rendered HTML slides"
      required: false
    - name: "presentation.pptx"
      format: "Rendered PPTX deck"
      required: false
    - name: "presentation.render_manifest.json"
      format: "JSON (render QA + hashes + slide count)"
      required: false
    - name: "charts/"
      format: "Directory of required PNG charts"
      required: true

constraints:
  # ═══════════════════════════════════════════════════════════════════
  # STOP RULES - When to halt and ask user (CRITICAL)
  # Based on Casey Optical Too workflow errors
  # ═══════════════════════════════════════════════════════════════════
  stop_rules:
    - condition: "templates/presentation_template.md is missing"
      action: "STOP and ask user - DO NOT generate from scratch"
      reason: "Generated templates have untested CSS/HTML and look unprofessional"

    - condition: "Template does NOT contain class='pf-table' (v4 Paths Forward HTML)"
      action: "STOP and ask user - template must be updated"
      reason: "Markdown tables render without styling (Error 2 from Casey Optical)"

    - condition: "Any required reference file is missing (slide18_paths_forward_v4.md)"
      action: "STOP and ask user - DO NOT improvise"
      reason: "Reference files define required structure"

    - condition: "FTE calculation results in less than 40 hours weekly coverage"
      action: "STOP and ask user - verify business hours"
      reason: "Values below 40 hours suggest data entry error"

    - condition: "Calculated pricing falls below minimums (Pilot: $600, Inbound/RHC: $480)"
      action: "STOP and apply minimum, then confirm with user"
      reason: "Pricing minimums are business requirements (Error 4)"

    - condition: "Disposition unknown_pct > 10%"
      action: "STOP and ask user - data quality issue"
      reason: "High unknown dispositions indicate mapping problems"

    - condition: "Monte Carlo FTE differs from CDF FTE by more than 1.0"
      action: "STOP and reconcile - calculation error likely"
      reason: "FTE methods should agree within tolerance"

    - condition: "Any chart file size is 0 bytes"
      action: "STOP and escalate - chart generation failed"
      reason: "Empty charts will break presentation (Error 6)"

    - condition: "Quality grade is D or F"
      action: "STOP and ask user before proceeding"
      reason: "Poor grade may indicate data issues or require special handling"

  # ═══════════════════════════════════════════════════════════════════
  # MUST DO RULES - Mandatory actions (with explicit validations)
  # ═══════════════════════════════════════════════════════════════════
  must_do:
    # === PRE-FLIGHT CHECKS (NEW) ===
    - "Run pre-flight checks before starting workflow"
    - "STOP and ask user if templates/presentation_template.md is missing - DO NOT generate from scratch"
    - "Verify template includes v4 Paths Forward HTML (pf-table class) before proceeding"
    - "Load config/pricing_constants.yaml and validate all minimums are present"

    # === DISCOVERY ===
    - "Confirm timezone, business hours, closures, and per-location overrides before analysis"
    - "Explicitly ask about Pilot Program inclusion (Yes/No) - do not assume"

    # === ANALYSIS ===
    - "Compute primary KPIs from OPEN HOURS inbound calls only"
    - "Use a deterministic Monte Carlo seed derived from stable dataset fingerprint"
    - "Treat closures as CLOSED hours even during normal business hours"

    # === PRICING (with minimum enforcement) ===
    - "Apply pricing minimums: Pilot >= $600, Inbound/RHC >= $480, RHC+Growth >= $980"
    - "Enforce minimum 40 weekly hours for FTE calculation"
    - "Run deterministic pricing/FTE checks before deck generation when possible"
    - "Log any minimum enforcement: 'Applied minimum: calculated $X, set to $Y'"

    # === CHARTS (with verification) ===
    - "Validate all chart files exist and have size > 0 before presentation phase"
    - "Verify chart dimensions are correct (1000x700 or as specified)"

    # === PRESENTATION (with validation) ===
    - "Use `output/<client_slug>/presentation.md` as the source of truth for all renders"
    - "Slide 18 (Paths Forward) must be built as v4 HTML (no markdown table)"
    - "Verify zero unreplaced {{PLACEHOLDER}} tokens after template population"
    - "Client-facing pricing/options slides must list services included per option and savings vs in-house"
    - "If mentioning FTE, use approved phrasing separate from pricing"

    # === QA (mandatory - never skip) ===
    - "Run visual verification on slides 1, 5, 8, 18 before marking complete"
    - "Perform automated + visual QA (HTML + PPTX) before delivery"
    - "If Slide 18 uses markdown table, STOP and fix to use v4 HTML"
    - "Verify all image paths resolve to existing files"

  # ═══════════════════════════════════════════════════════════════════
  # MUST NOT RULES - Forbidden actions (NEVER do these)
  # ═══════════════════════════════════════════════════════════════════
  must_not:
    # === NEVER IMPROVISE ===
    - "Generate presentation content from scratch when template is missing - ALWAYS stop and ask"
    - "Use a markdown table for Slide 18 - MUST use v4 HTML pf-table structure"
    - "Skip the template validation step"
    - "Proceed with a template that doesn't match the slide18_paths_forward_v4.md specification"
    - "Guess or assume values for missing data - always ask user"
    - "Mark a phase complete if validation fails - FIX first"

    # === PRICING RULES ===
    - "Use pricing below minimums (Pilot: $600/week, Inbound/RHC: $480, RHC+Growth: $980, Hire: $960)"
    - "Calculate FTE for less than 40 weekly hours"
    - "Show FTE numbers adjacent to prices in any client-facing table"
    - "Show hourly rates, OT rates, weekend premiums, or formula breakdowns in the client deck"

    # === DATA QUALITY ===
    - "Proceed with ambiguous redirected/transferred/forwarded semantics without confirmation"
    - "Proceed with disposition unknown_pct > 10% without user confirmation"

    # === OUTPUT RULES ===
    - "Skip visual verification of rendered HTML before marking complete"
    - "Deliver any deck with unreplaced template variables ({{PLACEHOLDER}} tokens)"
    - "Include emojis in client-facing materials"
    - "Use decorative iconography in the client deck (except specified SVG icons in Slide 18)"
    - "Trust command exit code without verifying output files exist and have size > 0"

    # === QA RULES ===
    - "Skip any QA step - all QA is mandatory"
    - "Deliver presentation without visual verification of critical slides (1, 5, 8, 18)"

# ═══════════════════════════════════════════════════════════════════
# BUSINESS CONSTANTS - Pricing minimums and thresholds
# ═══════════════════════════════════════════════════════════════════
config:
  pricing_minimums:
    PILOT_WEEKLY_MIN: 600           # $600/week minimum for pilot
    INBOUND_WEEKLY_MIN: 480         # $480/week minimum (1 FTE)
    RHC_WEEKLY_MIN: 480             # $480/week minimum (1 FTE)
    RHC_GROWTH_WEEKLY_MIN: 980      # $480 + $500 add-on minimum
    HIRE_WEEKLY_MIN: 960            # $960/week minimum (1 FTE)

  coverage_minimums:
    WEEKLY_HOURS_MIN: 40            # Minimum weekly hours for any calculation
    FTE_MIN: 1.0                    # Minimum FTE (1 full-time equivalent)
    SHRINKAGE_FTE_MIN: 1.25         # Minimum shrinkage-adjusted FTE

  thresholds:
    DISPOSITION_UNKNOWN_MAX_PCT: 10 # Max acceptable unknown dispositions
    FTE_RECONCILIATION_TOLERANCE: 1.0  # Max allowed diff between CDF and MC
    CHART_MIN_SIZE_BYTES: 1000      # Minimum chart file size

  critical_slides:
    - 1   # Title
    - 5   # Primary KPIs
    - 8   # Process vs Capacity
    - 18  # Paths Forward

learning:
  enabled: true
  mode: "auto_safe"
  auto_update:
    edge_priorities: true
    relationship_weights: true
    guard_thresholds: false
    node_prompts: false
    add_nodes: false
    remove_nodes: false
    add_edges: false
    remove_edges: false
  requires_approval:
    - "structural_changes"
    - "constraint_changes"
    - "pricing_formula_changes"
    - "quality_threshold_changes"
    - "new_skills"
  feedback_sources:
    - "outcome"
    - "user_feedback"
    - "quality_scores"

execution:
  max_steps: 200
  max_parallel: 5
  timeout_seconds: 7200
  max_retries: 3

skills:
  available: []
  auto_discover: true

metadata:
  tags:
    - "phone"
    - "analysis"
    - "pricing"
    - "presentation"
    - "mybcat"
    - "claude-code"
  notes: "Claude Code optimized variant derived from `phone_to_present/` workflow docs, template contract, and verification checklist."
